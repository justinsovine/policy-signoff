{
  "info": {
    "name": "PolicySignoff API",
    "description": "Cookie-based SPA auth via Laravel Sanctum.\n\nQuick start:\n1. Run Auth / 1. CSRF Cookie — stores the XSRF token as a collection variable.\n2. Run Auth / 2. Login — establishes the session.\n3. All other requests are ready to use.\n\nNote: Postman must have cookie handling enabled for localhost. In Postman v10+, go to Settings → Cookies and add localhost to the allowed list.",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "variable": [
    {
      "key": "base_url",
      "value": "http://localhost:8000",
      "type": "string"
    },
    {
      "key": "xsrf_token",
      "value": "",
      "type": "string"
    },
    {
      "key": "policy_id",
      "value": "1",
      "type": "string"
    }
  ],
  "item": [
    {
      "name": "Auth",
      "item": [
        {
          "name": "1. CSRF Cookie",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "const token = pm.cookies.get('XSRF-TOKEN');",
                  "if (token) {",
                  "    pm.collectionVariables.set('xsrf_token', decodeURIComponent(token));",
                  "    console.log('xsrf_token stored');",
                  "} else {",
                  "    console.warn('XSRF-TOKEN cookie not found — enable cookie handling for localhost in Postman settings');",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/sanctum/csrf-cookie",
              "host": ["{{base_url}}"],
              "path": ["sanctum", "csrf-cookie"]
            }
          }
        },
        {
          "name": "2. Login",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "const token = pm.cookies.get('XSRF-TOKEN');",
                  "if (token) {",
                  "    pm.collectionVariables.set('xsrf_token', decodeURIComponent(token));",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              { "key": "X-XSRF-TOKEN", "value": "{{xsrf_token}}" },
              { "key": "Accept", "value": "application/json" },
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"email\": \"jane@example.com\",\n    \"password\": \"password\"\n}",
              "options": { "raw": { "language": "json" } }
            },
            "url": {
              "raw": "{{base_url}}/login",
              "host": ["{{base_url}}"],
              "path": ["login"]
            }
          }
        },
        {
          "name": "Get Current User",
          "request": {
            "method": "GET",
            "header": [
              { "key": "Accept", "value": "application/json" }
            ],
            "url": {
              "raw": "{{base_url}}/user",
              "host": ["{{base_url}}"],
              "path": ["user"]
            }
          }
        },
        {
          "name": "Register",
          "request": {
            "method": "POST",
            "header": [
              { "key": "X-XSRF-TOKEN", "value": "{{xsrf_token}}" },
              { "key": "Accept", "value": "application/json" },
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"name\": \"Test User\",\n    \"email\": \"test@example.com\",\n    \"password\": \"password\",\n    \"password_confirmation\": \"password\"\n}",
              "options": { "raw": { "language": "json" } }
            },
            "url": {
              "raw": "{{base_url}}/register",
              "host": ["{{base_url}}"],
              "path": ["register"]
            }
          }
        },
        {
          "name": "Logout",
          "request": {
            "method": "POST",
            "header": [
              { "key": "X-XSRF-TOKEN", "value": "{{xsrf_token}}" },
              { "key": "Accept", "value": "application/json" }
            ],
            "url": {
              "raw": "{{base_url}}/logout",
              "host": ["{{base_url}}"],
              "path": ["logout"]
            }
          }
        }
      ]
    },
    {
      "name": "Policies",
      "item": [
        {
          "name": "List Policies",
          "request": {
            "method": "GET",
            "header": [
              { "key": "Accept", "value": "application/json" }
            ],
            "url": {
              "raw": "{{base_url}}/api/policies",
              "host": ["{{base_url}}"],
              "path": ["api", "policies"]
            }
          }
        },
        {
          "name": "Get Policy",
          "request": {
            "method": "GET",
            "header": [
              { "key": "Accept", "value": "application/json" }
            ],
            "url": {
              "raw": "{{base_url}}/api/policies/{{policy_id}}",
              "host": ["{{base_url}}"],
              "path": ["api", "policies", "{{policy_id}}"]
            }
          }
        },
        {
          "name": "Create Policy",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "const res = pm.response.json();",
                  "if (res && res.id) {",
                  "    pm.collectionVariables.set('policy_id', String(res.id));",
                  "    console.log('policy_id set to', res.id);",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              { "key": "X-XSRF-TOKEN", "value": "{{xsrf_token}}" },
              { "key": "Accept", "value": "application/json" },
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"title\": \"Test Policy\",\n    \"description\": \"This is a test policy created via Postman.\",\n    \"due_date\": \"2026-12-31\"\n}",
              "options": { "raw": { "language": "json" } }
            },
            "url": {
              "raw": "{{base_url}}/api/policies",
              "host": ["{{base_url}}"],
              "path": ["api", "policies"]
            }
          }
        }
      ]
    },
    {
      "name": "Sign-offs",
      "item": [
        {
          "name": "Sign Off on Policy",
          "request": {
            "method": "POST",
            "header": [
              { "key": "X-XSRF-TOKEN", "value": "{{xsrf_token}}" },
              { "key": "Accept", "value": "application/json" }
            ],
            "url": {
              "raw": "{{base_url}}/api/policies/{{policy_id}}/signoff",
              "host": ["{{base_url}}"],
              "path": ["api", "policies", "{{policy_id}}", "signoff"]
            }
          }
        }
      ]
    },
    {
      "name": "File Uploads",
      "item": [
        {
          "name": "Get Upload URL",
          "request": {
            "method": "POST",
            "header": [
              { "key": "X-XSRF-TOKEN", "value": "{{xsrf_token}}" },
              { "key": "Accept", "value": "application/json" },
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"filename\": \"test-policy.pdf\",\n    \"content_type\": \"application/pdf\"\n}",
              "options": { "raw": { "language": "json" } }
            },
            "url": {
              "raw": "{{base_url}}/api/policies/{{policy_id}}/upload-url",
              "host": ["{{base_url}}"],
              "path": ["api", "policies", "{{policy_id}}", "upload-url"]
            }
          }
        },
        {
          "name": "Get Download URL",
          "request": {
            "method": "GET",
            "header": [
              { "key": "Accept", "value": "application/json" }
            ],
            "url": {
              "raw": "{{base_url}}/api/policies/{{policy_id}}/download-url",
              "host": ["{{base_url}}"],
              "path": ["api", "policies", "{{policy_id}}", "download-url"]
            }
          }
        }
      ]
    }
  ]
}
